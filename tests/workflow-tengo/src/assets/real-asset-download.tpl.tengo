assets := import("@platforma-sdk/workflow-tengo:assets")
self := import("@platforma-sdk/workflow-tengo:tpl")
blobs := import("@platforma-sdk/workflow-tengo:file.internal")
workdir := import("@platforma-sdk/workflow-tengo:workdir")
execConstants := import("@platforma-sdk/workflow-tengo:exec.constants")

asset := assets.importAsset("@platforma-open/milaboratories.software-small-binaries:small-asset")

self.defineOutputs(["main"])

self.prepare(func(inputs) {
	assetDescriptor := asset.descriptor.asset

	archive := blobs.createBlobImportExternal({
		dataURL: assetDescriptor.url
	}).file

	return {
		archive: archive
	}
})

self.body(func(inputs) {
	wd := workdir.builder().
		inQueue(execConstants.LIGHT_QUEUE).
		addFromZip(inputs.archive, ".", []).
		build()

	fileName := "file1.txt"

	result := workdir.save(wd).
		saveFileContent(fileName).
		build()

	return {
		main: result.filesContent.getFutureInputField(fileName)
	}
})
