assets := import("@platforma-sdk/workflow-tengo:assets")
maps := import("@platforma-sdk/workflow-tengo:maps")
pframes := import("@platforma-sdk/workflow-tengo:pframes")

bodyTpl := assets.importTemplate(":pframes.test.proc_4_parquet_body")

self := import("@platforma-sdk/workflow-tengo:tpl")

self.awaitState("InputsLocked")
self.awaitState("params", "ResourceReady")

self.body(func(inputs) {
	spec := inputs.spec
	data := inputs.data
	params := inputs.params

	processResult := pframes.processColumn({
			spec: spec,
			data: data
		},
		bodyTpl,
		[{
			name: "parquet",
			type: "Xsv",
			xsvType: "parquet",
			settings: params.xsvSettings
		}]
	)

	return {
		result: pframes.exportFrame(processResult.allOutputsFrame())
	}
})
