# Generated with protoc-gen-openapi
# https://github.com/google/gnostic/tree/master/cmd/protoc-gen-openapi

openapi: 3.0.3
info:
  title: Streaming API
  description: |-
    Streaming provides access to online data stream from item in storage. Whenever item is appended with data,
     the caller receives this fresh data in stream from server.
  version: 0.0.1
paths:
  /v1/last-lines:
    post:
      tags:
        - Streaming
      description: "LastLines provides single message with the last lines from data source.\n When search pattern is specified, the last lines matching the given pattern are returned.\n The lines are returned in reversed order, as server reads data source from the end.\n Consider it as equivalent to 'tac <file> | grep <search> | head -n <line_count>'\n The <new_offset> returned in the response points to the _beginning_ of the last \n line found, so client can continue reading the file backwards in subsequent calls.\n This means, that use of this <new_offset> in ReadText() will return you the same line\n returned last in LastLines() data."
      operationId: Streaming_LastLines
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/StreamingAPI_LastLines"
        required: true
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/StreamingAPI_Response"
        default:
          description: Default error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Status"
  /v1/read/binary:
    post:
      tags:
        - Streaming
      description: "ReadBinary allows to read remote item in chunks using stream-like API.\n The difference to StreamBinary is that the client receives single response for each \n call and has to send new calls to the server to get fresh data from remote item.\n Each response (each chunk from server) keeps not more than 3.9MiB of data."
      operationId: Streaming_ReadBinary
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/StreamingAPI_ReadBinary"
        required: true
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/StreamingAPI_Response"
        default:
          description: Default error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Status"
  /v1/read/text:
    post:
      tags:
        - Streaming
      description: "ReadBinary allows to read remote item in chunks using stream-like API.\n The difference to StreamBinary is that the client receives single response for each \n call and has to send new calls to the server to get fresh data from remote item.\n Each response (each chunk from server) keeps not more than 3.9MiB of data."
      operationId: Streaming_ReadText
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/StreamingAPI_ReadText"
        required: true
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/StreamingAPI_Response"
        default:
          description: Default error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Status"
  /v1/stream/binary:
    post:
      tags:
        - Streaming
      description: |-
        StreamBinary provides stream of binary file. Each response message keeps
         one single chunk of binary data from data source. See StreamingAPI.Binary message
         for more info on available options.
      operationId: Streaming_StreamBinary
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/StreamingAPI_StreamBinary"
        required: true
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/StreamingAPI_Response"
        default:
          description: Default error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Status"
  /v1/stream/text:
    post:
      tags:
        - Streaming
      description: |-
        StreamText provides stream of textual file, splitting the data by newline symbol.
         Each response message keeps one single line of text from data source.
      operationId: Streaming_StreamText
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/StreamingAPI_StreamText"
        required: true
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/StreamingAPI_Response"
        default:
          description: Default error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Status"
components:
  schemas:
    GoogleProtobufAny:
      type: object
      properties:
        "@type":
          type: string
          description: The type of the serialized message.
      additionalProperties: true
      description: Contains an arbitrary serialized message along with a @type that describes the type of the serialized message.
    Status:
      type: object
      properties:
        code:
          type: integer
          description: The status code, which should be an enum value of [google.rpc.Code][google.rpc.Code].
          format: int32
        message:
          type: string
          description: A developer-facing error message, which should be in English. Any user-facing error message should be localized and sent in the [google.rpc.Status.details][google.rpc.Status.details] field, or localized by the client.
        details:
          type: array
          items:
            $ref: "#/components/schemas/GoogleProtobufAny"
          description: A list of messages that carry the error details.  There is a common set of message types for APIs to use.
      description: "The `Status` type defines a logical error model that is suitable for different programming environments, including REST APIs and RPC APIs. It is used by [gRPC](https://github.com/grpc). Each `Status` message contains three pieces of data: error code, error message, and error details. You can find out more about this error model and how to work with it in the [API Design Guide](https://cloud.google.com/apis/design/errors)."
    StreamingAPI_LastLines:
      type: object
      properties:
        resourceId:
          type: string
          description: <resource_id> of Stream resource, that keeps info on item to be streamed.
        offset:
          type: string
          description: "<offset> makes streamer to perform seek operation to given offset before sending the contents.\n This offset is taken in BYTES, as it eases streaming recovery after client reconnection or controller restart.\n By default, LastLines starts to treat the data source from the very last byte available in data stream \n at the moment of call, but client can set the server to start from earlier position."
        lineCount:
          type: integer
          description: |-
            <line_count> makes streamer to return up to <line_count> lines to the client.
             Default value: 1
          format: int32
        search:
          type: string
          description: |-
            <search> is substring for line search pattern.
             This option makes controller to send to the client only lines, that
             have given substring.
        searchRe:
          type: string
          description: |-
            <search_re> is regular expression for line search pattern.
             This option makes controller to send to the client only lines, that
             match given regular expression.
    StreamingAPI_ReadBinary:
      type: object
      properties:
        resourceId:
          type: string
          description: <resource_id> of Stream resource, that keeps info on item to be streamed.
        offset:
          type: string
          description: <offset> makes streamer to perform seek operation to given offset before sending the data.
        chunkSize:
          type: integer
          description: |-
            <chunk_size> limits the maximum size of <data> for response message in stream.

             Default value: 32 768 (32 KiB)
             Max value: 3900 * 1024 (3.9 MiB)
          format: uint32
    StreamingAPI_ReadText:
      type: object
      properties:
        resourceId:
          type: string
          description: <resource_id> of Stream resource, that keeps info on item to be streamed.
        offset:
          type: string
          description: |-
            <offset> makes streamer to perform seek operation to given offset before sending the contents.
             This offset is taken in BYTES, as it eases streaming recovery after client reconnection or controller restart.
             Client can just use the <new_offset> value of the last response from server to continue streaming after reconnection.
        readLimit:
          type: string
          description: |-
            <read_limit> allows client to limit total data sent from server.
             Measured in lines of text.
             E.g. to read top 1000 lines from stream source, use <read_limit> = 1000.
             When both <read_limit> and <search>/<search_re> are set, the <read_limit> is applied first.
             this is equivalent to 'head -n <read_limit> | grep <search>'.
             At most 3.9 MiB (3900 * 1024 KiB) of data is returned in single read regardless of <read_limit> option
             Only full lines of text are returned except for the last line from the completed source
             (the one that is not expected to have new data, like blob in storage)
        search:
          type: string
          description: |-
            <search> is substring for line search pattern.
             This option makes controller to send to the client only lines, that
             have given substring.
        searchRe:
          type: string
          description: |-
            <search_re> is regular expression for line search pattern.
             This option makes controller to send to the client only lines, that
             match given regular expression.
    StreamingAPI_Response:
      type: object
      properties:
        data:
          type: string
          description: data chunk from item, starting from the <new_offset> of the previous message in the same stream.
          format: bytes
        size:
          type: string
          description: "<size> is the actual size of the streamed item at the moment of this message.\n This might be not a final amount of streamed data, as stream source can be updated \n by other independent process (e.g., data is written to log file).\n This field in combination with <new_offset> shows, how far the client is from the end\n of the data right now."
        newOffset:
          type: string
          description: |-
            <new_offset> is the new offset in bytes from the start of the streamed item,
             including size of <data> in current response.
             Call to Stream rpc with <offset> = <new_offset> will continue
             streaming from the place of last received message
             (e.g. <offset> = <new_offset> - 1 will repeat the last byte of
             previously received <data>)
    StreamingAPI_StreamBinary:
      type: object
      properties:
        resourceId:
          type: string
          description: <resource_id> of Stream resource, that keeps info on item to be streamed.
        offset:
          type: string
          description: <offset> makes streamer to perform seek operation to given offset before sending the data.
        chunkSize:
          type: integer
          description: |-
            <chunk_size> limits the maximum size of <data> for each response message in stream.

             Default value: 32 768 (32 KiB)
             Max value: 3900 * 1024 (3.9 MiB)
          format: uint32
        readLimit:
          type: string
          description: |-
            <read_limit> allows client to limit total data sent from server.
             This limit is aggregation of all data, sent in all chunks.
             E.g. to read 2000 bytes of data in chunks of at most
             130 bytes, use <chunk_size> = 130; <read_limit> = 2000.
             For storage item of appropriate size this settings will result in
             16 messages from server: 15 of 130 bytes and one of 50 bytes.
    StreamingAPI_StreamText:
      type: object
      properties:
        resourceId:
          type: string
          description: <resource_id> of Stream resource, that keeps info on item to be streamed.
        offset:
          type: string
          description: |-
            <offset> makes streamer to perform seek operation to given offset before sending the contents.
             This offset is taken in BYTES, as it eases streaming recovery after client reconnection or controller restart.
             Client can just use the <new_offset> value of the last response from server to continue streaming after reconnection.
        readLimit:
          type: string
          description: "<read_limit> allows client to limit total data sent from server.\n This limit is aggregation of all data, sent in all chunks, measured \n in lines of text.\n E.g. to read top 1000 lines from stream source, use <read_limit> = 1000.\n When both <read_limit> and <search>/<search_re> are set, the <read_limit> is applied first.\n this is equivalent to 'head -n <read_limit> | grep <search>'."
        search:
          type: string
          description: |-
            <search> is substring for line search pattern.
             This option makes controller to send to the client only lines, that
             have given substring.
        searchRe:
          type: string
          description: |-
            <search_re> is regular expression for line search pattern.
             This option makes controller to send to the client only lines, that
             match given regular expression.
tags:
  - name: Streaming
