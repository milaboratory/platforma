# Generated with protoc-gen-openapi
# https://github.com/google/gnostic/tree/master/cmd/protoc-gen-openapi

openapi: 3.0.3
info:
  title: Upload API
  description: Upload provides access to data upload feature, allowing clients to uplad data to Platforma.
  version: 0.0.1
paths:
  /v1/upload/finalize:
    post:
      tags:
        - Upload
      description: |-
        Finalize informs Controller that the upload process is done.
         Returns an error, if the total size of all uploaded chunks is not equal to
         size of the upload given in Init.
      operationId: Upload_Finalize
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Finalize_Request"
        required: true
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Finalize_Response"
        default:
          description: Default error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Status"
  /v1/upload/get-part-url:
    post:
      tags:
        - Upload
      description: |-
        GetPartURL provides URL for uploading chunk of the data.
         Clients are expected to put their data directly to the given location.
      operationId: Upload_GetPartURL
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/GetPartURL_Request"
        required: true
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/GetPartURL_Response"
        default:
          description: Default error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Status"
  /v1/upload/init:
    post:
      tags:
        - Upload
      description: Init upload, making controller to do all required preparation steps.
      operationId: Upload_Init
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Init_Request"
        required: true
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Init_Response"
        default:
          description: Default error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Status"
  /v1/upload/update-progress:
    post:
      tags:
        - Upload
      description: UpdateProgress of the upload, so other clients can see how it is going.
      operationId: Upload_UpdateProgress
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateProgress_Request"
        required: true
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UpdateProgress_Response"
        default:
          description: Default error response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Status"
components:
  schemas:
    Finalize_Request:
      type: object
      properties:
        resourceId:
          type: string
    Finalize_Response:
      type: object
      properties: {}
    GetPartURL_HTTPHeader:
      type: object
      properties:
        name:
          type: string
        value:
          type: string
    GetPartURL_Request:
      type: object
      properties:
        resourceId:
          type: string
          description: Id of upload resource
        partNumber:
          type: string
          description: |-
            Part to be uploaded. It is responsibility of the Client to watch after already uploaded parts:
             - client can request an URL for the same part twice (request -> request) without errors;
             - client can request an URL for alrady uploaded part (request -> upload -> request) without errors.

             Parts enumeration starts from 1.
        uploadedPartSize:
          type: string
          description: |-
            Size of the part uploaded by client earlier. Allows controller to count upload progress
             based on client's input.
             Client is free to never sent this value (send zeroes in each request).
        isInternalUse:
          type: boolean
          description: |-
            Do we need to presign URL for internal use.
             Controllers could use this if they are trying to download something from internal network.
             For backward compatibility, by default pl backend will presign external urls.
        partChecksum:
          type: string
          description: |-
            Checksum is not used for now, but it is here for case
             where signing checksum header is required.
    GetPartURL_Response:
      type: object
      properties:
        uploadUrl:
          type: string
          description: URL for chunk upload
        method:
          type: string
          description: HTTP method to use for chunk upload, say 'PUT' or 'POST'.
        headers:
          type: array
          items:
            $ref: "#/components/schemas/GetPartURL_HTTPHeader"
          description: |-
            List of headers with their values, MANDATORY to be sent by the client for the upload.
             The destination service (the one, that will handle upload request for specific part)
             may reject the request if it would not keep the given headers.
        chunkStart:
          type: string
          description: |-
            The number of the _first_ byte in the chunk.
             Absolute position from the start of the file ( file.seek(<chunk_start>, SEEK_START) ).
             The client is expected to send [<chunk_start>; <chunk_end>) range.
        chunkEnd:
          type: string
          description: |-
            The number of the byte _after_ the last to be sent in the chunk.
             Absolute position from the start of the file.
             The client is expected to send [<chunk_start>; <chunk_end>) range.
    GoogleProtobufAny:
      type: object
      properties:
        "@type":
          type: string
          description: The type of the serialized message.
      additionalProperties: true
      description: Contains an arbitrary serialized message along with a @type that describes the type of the serialized message.
    Init_Request:
      type: object
      properties:
        resourceId:
          type: string
          description: Id of upload resource
    Init_Response:
      type: object
      properties:
        partsCount:
          type: string
          description: |-
            Number of parts in this upload.
             For parallel upload support, client can generate any number of part upload URLs
             at the moment and upload them in parallel.
             <parts_count> keeps the number of chunks supported by this upload.
             The parts count is calculated from the planned size of the upload, controller
             configuration and underlying storage restrictions.
        partSize:
          type: string
        checksumAlgorithm:
          type: integer
          description: Checksum algorithm to use for the part upload.
          format: enum
        checksumHeader:
          type: string
          description: Header name to use for the checksum.
        uploadedParts:
          type: array
          items:
            type: string
          description: |-
            List of IDs of parts that were already uploaded by client.
             Helps client to recover upload and skip already done parts
             after being interrupted in the middle of the upload
             (say, because of the restart).
             Parts enumeration starts from 1.
    Status:
      type: object
      properties:
        code:
          type: integer
          description: The status code, which should be an enum value of [google.rpc.Code][google.rpc.Code].
          format: int32
        message:
          type: string
          description: A developer-facing error message, which should be in English. Any user-facing error message should be localized and sent in the [google.rpc.Status.details][google.rpc.Status.details] field, or localized by the client.
        details:
          type: array
          items:
            $ref: "#/components/schemas/GoogleProtobufAny"
          description: A list of messages that carry the error details.  There is a common set of message types for APIs to use.
      description: "The `Status` type defines a logical error model that is suitable for different programming environments, including REST APIs and RPC APIs. It is used by [gRPC](https://github.com/grpc). Each `Status` message contains three pieces of data: error code, error message, and error details. You can find out more about this error model and how to work with it in the [API Design Guide](https://cloud.google.com/apis/design/errors)."
    UpdateProgress_Request:
      type: object
      properties:
        resourceId:
          type: string
          description: Id of upload resource
        bytesProcessed:
          type: string
          description: |-
            Amount of bytes, uploaded since the earlier call to UpdateProgress.
             This value is just blindly added to the 'bytes_processed' of progress report,
             so other clients can see the upload progress.
             If client uploads the data in several streams (several chunks in parallel), it
             can safely send progress updates individually for each of the streams, just counting
             bytes uploaded by particular stream.

             Negative value can be used to report about upload retry: when upload was interrupted,
             part of the uploaded data is lost and require re-upload.
    UpdateProgress_Response:
      type: object
      properties: {}
tags:
  - name: Upload
